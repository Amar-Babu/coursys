{% extends "marking/base.html" %}
{% load course_display %}

{% block marking_header_extra %}
<script type="text/javascript">
function append_problem(n, content)
{       
    var comments = document.querySelectorAll("textarea");    
	var oldconent = comments[n-1].value;	
	comments[n-1].value += (oldconent == '' ? '' : '; ') + content;
}
</script>
{% endblock%}

{% block h1 %}{{activity.name}} Marking {% endblock %}

{% block subbreadcrumbs %}<li>&gt; <a href="{% url grades.views.course_info course_slug=course.slug %}">{{course}}</a></li><li>&gt; <a href="{% url marking.views.marking course_slug=course.slug, activity_slug=activity.slug %}">{{activity.name}} marking</a></li>{% endblock %}

{% block content %}
     
<div id = "form_container">
<div id = "marking_container">
<form action="" method="post" enctype="multipart/form-data">      
     {% if student %}
        <h2> Mark for Student: {{student}} </h2> 
     {% else %}
        {% if group %}
          <h2> Mark for Group: {{group}} </h2> 
        {% else %}
          <h2> Mark for: </h2>
	      <div class = "receiver"> {{student_receiver_form}} </div>
	      <b> OR </b>
	      <div class = "receiver"> {{group_receiver_form}} </div> 
	    {% endif %}
	 {% endif %}
	 {% for entry in mark_components %}  	     
	     <fieldset>
	     <legend>{{entry.component.title}}</legend> 
		     <ul>
		        <li class = "common_problems">
			    {% with forloop.counter as pos %}
			    <b>Common problems:</b>     
			    {% for problem in entry.common_problems %}
			        <input type = "button" value = "{{problem.title|escape}}" title = "{{problem.description|escape}}" OnClick = "append_problem({{pos}}, '{{problem.description|escapejs}}');"/>	 
			    {% empty %}	     
			    None    	     
			    {% endfor %}
			    {% endwith %}
			    </li>	     		       
		        <li class = "view">		            
		      		<div class="inputfield">		      		 
		        	Comment {{ entry.form.comment }}
		      		{% if entry.form.comment.errors %}		      		
		      		<img src="{{MEDIA_URL}}/icons/error.png" alt="error"/>&nbsp;{{entry.form.comment.errors}}		      		
		      		{% endif %}
		      		</div>			      	  	
				</li>
				<li class = "view"> 
		            <div class = "inputfield">
		        	Mark {{entry.form.value}} Out of {{entry.component.max_mark}}
		        	{% if entry.form.value.errors %}		        	
		        	<img src="{{MEDIA_URL}}/icons/error.png" alt="error"/>&nbsp;{{entry.form.value.errors}}		        	
		        	{% endif %}
		       		</div>
		        </li>				
		 	</ul>   	 
	  </fieldset>
     {% empty %}
	   	<h3> No Components to Mark</h3>
	 {% endfor %}	 
	 <fieldset>
	 <legend>Additional Information</legend>
	 {{additional_info_form|display_form}}
	 </fieldset>     
</form>
</div>
</div>

{% endblock %}
