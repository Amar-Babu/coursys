{% extends "base.html" %}
{% load course_display form_display %}

{% block title %}New TA Contract {% endblock %}
{% block h1 %}New TA Contract {% endblock %}

{% block subbreadcrumbs %}
<li>&gt; <a href="{% url ta.views.all_contracts %}">TA Contracts</a></li>
<li>&gt; New</li>
{% endblock %}

{% block headextra %}
<script type="text/javascript">
//<![CDATA[
    $(document).ready(function() {    	
    	//adding base units
    	var rows = $("#ta_course tr:gt(0)");
    	rows.children("td:nth-child(3)").change(function() {
    		var total = 0;
    		for(var i = 0; i < 3; i++){
    			val = parseFloat($('#id_tacourse_set-' + i + '-bu').val())
    			if(val > 0)
    				total += val
    		}
    		$('#total_bu').html(total)    		
    	})
    	
    	//setting rates per bu based on appt category
    	$('#id_appt_category').change(function(){
    		var cat = $(this).val()
    		$.post("{% url ta.views.new_contract post_slug=posting.slug %}",
  				{'csrfmiddlewaretoken': "{{csrf_token}}", 'appt_cat': cat},
  				function(data){
    			 $('#salary_per_bu').val(data.split(',')[0])
    			 $('#schol_per_bu').val(data.split(',')[1])
   			 	});
    	})
    	
    	//salary calculation
    	$('#button_cal').click(function() {
    		var salary_rate = parseFloat($('#salary_per_bu').val())
    		var schol_rate = parseFloat($('#schol_per_bu').val())
    		var bu = parseFloat($('#total_bu').html())
    		var salary_sem = (bu * salary_rate).toFixed(2)
    		var schol_sem = (bu * schol_rate).toFixed(2)
    		$('#salary_sem').val(salary_sem)
    		$('#schol_sem').val(schol_sem)
    		var salary_bi = (salary_sem / 17 * 2).toFixed(2)
    		var schol_bi = (schol_sem / 17 * 2).toFixed(2)
    		$('#salary_bi').val(salary_bi)
    		$('#schol_bi').val(schol_bi)
    	})
    });
    
//]]>
</script>
{% endblock %}

{% block content %}

<div id="form_container">
<form action="{% url ta.views.new_contract post_slug=posting.slug%}" method="post">{% csrf_token %}
<fieldset class="wide">
<legend>General Info</legend>
{{ form|as_dl }}
</fieldset>

<fieldset>
<legend>Course and Payment Details</legend>
	<div class="table_container">
	  {{ formset.management_form }} 	
      <table class="display" id="ta_course">
      	<thead class="form_head">
          <tr>
         	<th scope="col">Course</th>
         	<th scope="col">Description</th>
         	<th scope="col">Base Unit</th>         
          </tr>         
        </thead>  
        <tbody>
		  {% for form in formset.forms %} 	      
		      {{ form|display_form_as_row }}
	      {% endfor %}
	      <tr>
	      	<td></td>
	      	<td class="table-row-label" id="total_bu_label" align="right">Total Base Units:&nbsp;</td>
	      	<td class="table-row-label" id="total_bu">0</td>
	      </tr>
	      <tr><td colspan=3><span class="submit" id="button_cal" >Calculate</span></td></tr>
        </tbody>
      </table>
   </div>
   <p></p>
   	<div class="table_container"> 
      <table class="info" id="ta_pay">
      	<thead class="form_head">
          <tr>
         	<th scope="col"></th>
         	<th scope="col">Pay Per BU</th>
         	<th scope="col">Biweekly Rate</th>
         	<th scope="col">Semester Rate</th>
          </tr>         
        </thead>  
        <tbody>
        	<tr> 
        		<th class="ui-state-default">Salary</th>
        		<td><input id="salary_per_bu" type="text" value="" /></td>
        		<td><input id="salary_bi" type=text readonly="readonly" value="" /></td>
        		<td><input id="salary_sem" type=text readonly="readonly" value="" /></td>
        	</tr>
        	<tr>
        		<th class="ui-state-default">Scholarship</th>
        		<td><input id="schol_per_bu" type="text" value=""/></td>
        		<td><input id="schol_bi" type=text readonly="readonly" value="" /></td>
        		<td><input id="schol_sem" type=text readonly="readonly" value="" /></td>
        	</tr>
        </tbody>
      </table>
   </div>
</fieldset>

<p><input type="submit" class="submit" value="Submit" /></p>

</form>
</div>

{% endblock %}
