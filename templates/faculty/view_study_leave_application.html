{% extends "base.html" %}
{% load form_display %}
{% load staticfiles %}


{% block title %}View Study Leave Application{% endblock %}
{% block h1 %}View Study Leave Application{% endblock %}

{% block headextra %}
<script type="text/javascript">
$(document).ready(function() {
  $('#semester_activity').dataTable( {
    'bPaginate': false,
    'bInfo': false,
    'bLengthChange': false,
    "bJQueryUI": true,
    'aaSorting': [[0, 'asc']]
  } );

  $('#previous_leaves').dataTable( {
    'bPaginate': false,
    'bInfo': false,
    'bLengthChange': false,
    "bJQueryUI": true,
    'aaSorting': [[0, 'asc']]
  } );

} );


function confirmDelete() {
  return confirm("Are you sure you want to delete this activity?");
}
</script>
{% endblock %}


{% block actions %}
<div id="actions">
    <h2>Actions</h2>
    <ul>
        <li><a href="{% url "faculty:edit_study_leave_application" application_slug=application.slug %}">Edit</a></li>
        <li><a href="{% url "faculty:new_study_leave_application_semester_activity" application_slug=application.slug %}">Add Semester Activity</a></li>
    </ul>
</div>
{% endblock %}

{% block subbreadcrumbs %}
    <li><a href="{% url "faculty:study_leave_index" %}">Study Leave</a></li>
    <li>View Study Leave Application</li>
{% endblock %}

{% block content %}
    <dt>Rank</dt><dd>{{ application.get_rank_display }}</dd>
    <dt>Primary Department</dt><dd>{{ application.primary_department.name }}</dd>
    {% if application.secondary_department %}<dt>Secondary Department</dt><dd>{{ application.secondary_department.name }}</dd>{% endif %}
    <dt>Tenure</dt><dd>{{ application.get_tenure_display }}</dd>
    <dt>Tenure Date</dt><dd>{{ application.tenure_date }}</dd>
    <dt>Start Date</dt><dd>{{ application.start_date }}</dd>
    <dt>End Date</dt><dd>{{ application.end_date }}</dd>
    <dt>Leave Option</dt><dd>{{ application.get_leave_option_display }}</dd>
    <dt>Defer Salary</dt><dd>{{ application.defer_salary|yesno }}</dd>
    <dt>First Study Leave After Being Appointed Tenure</dt><dd>{{ application.first_study_leave|yesno }}</dd>
    <dt>Appointed Tenure</dt><dd>{{ application.get_appointed_tenure_display }}</dd>
    <dt>First Study Leave After 6 Years</dt><dd>{{ application.get_first_study_leave_after_6_years_display }}</dd>
    <dt>Academic Credits from Similar Institutions</dt><dd>{{ application.service_credits|linebreaks }}</dd>
    <dt>Supervises Grad Students</dt><dd>{{ application.get_grad_students_display }}</dd>
    <dt>Number of Masters Students</dt><dd>{{ application.masters_students }}</dd>
    <dt>Number of PhD/EdD Students</dt><dd>{{ application.phd_students }}</dd>
    <dt>Details of Grad Student Management During Leave</dt><dd>{{ application.manage_students_during_leave|linebreaks }}</dd>

    <h2>Previous Leaves</h2>
    <table id="previous_leaves">
        <thead>
            <tr>
                <th>Leave Number</th>
                <th>Start Date</th>
                <th>End Date</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td><span class="sort">{{ application.leave_1_start_date.isoformat }}</span>{{ application.leave_1_start_date }}</td>
                <td><span class="sort">{{ application.leave_1_end_date.isoformat }}</span>{{ application.leave_1_end_date }}</td>
            </tr>
            <tr>
                <td>2</td>
                <td><span class="sort">{{ application.leave_2_start_date.isoformat }}</span>{{ application.leave_2_start_date }}</td>
                <td><span class="sort">{{ application.leave_2_end_date.isoformat }}</span>{{ application.leave_2_end_date }}</td>
            </tr>
            <tr>
                <td>3</td>
                <td><span class="sort">{{ application.leave_3_start_date.isoformat }}</span>{{ application.leave_3_start_date }}</td>
                <td><span class="sort">{{ application.leave_3_end_date.isoformat }}</span>{{ application.leave_3_end_date }}</td>
            </tr>
            <tr>
                <td>4</td>
                <td><span class="sort">{{ application.leave_4_start_date.isoformat }}</span>{{ application.leave_4_start_date }}</td>
                <td><span class="sort">{{ application.leave_4_end_date.isoformat }}</span>{{ application.leave_4_end_date }}</td>
            </tr>
            <tr>
                <td>5</td>
                <td><span class="sort">{{ application.leave_5_start_date.isoformat }}</span>{{ application.leave_5_start_date }}</td>
                <td><span class="sort">{{ application.leave_5_end_date.isoformat }}</span>{{ application.leave_5_end_date }}</td>
            </tr>
            <tr>
                <td>6</td>
                <td><span class="sort">{{ application.leave_6_start_date.isoformat }}</span>{{ application.leave_6_start_date }}</td>
                <td><span class="sort">{{ application.leave_6_end_date.isoformat }}</span>{{ application.leave_6_end_date }}</td>
            </tr>
        </tbody>
    </table>


    {% if application.activities.visible %}
        <h2>Semester Activity</h2>
        <table id="semester_activity">
            <thead>
                <tr>
                    <td>Semester</td>
                    <td>Activity</td>
                    <td>Action</td>
                </tr>
            </thead>

            {% for act in application.activities.visible %}
                <tr>
                    <td><span class="sort">{{ act.semester.name }}</span>{{ act.semester.label }}</td>
                    <td>{{ act.get_activity_display }}</td>
                    <td>
                        <form class="lineform" method="POST"
                          action="{% url "faculty:delete_study_leave_application_semester_activity" semester_activity_slug=act.slug %}"
                          onsubmit="return confirmDelete()">
                        {% csrf_token %}
                        <button type='submit' class='btn' title="Delete Activity">
                            <i class='fa fa-trash-o'></i>
                        </button>
                    </form>
                    <form class="lineform" method="GET"
                        action="{% url "faculty:edit_study_leave_application_semester_activity" semester_activity_slug=act.slug %}">
                        <button type='submit' class='btn' title="Edit Activity">
                            <i class='fa fa-edit'></i>
                        </button>
                    </form>
                    </td>
                </tr>
            {% endfor %}
        </table>
    {% else %}
        <h2>This application does not have any semester activities associated with it.  You should probably add some.</h2>
    {% endif %}
    <p class="logentry">Last Modified on {{ application.last_modified }}{% if application.last_modified_by %} by {{ application.last_modified_by }}{% endif %}.</p>
{% endblock %}


