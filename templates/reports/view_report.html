{% extends "base.html" %}
{% block title %}Report: {{report.name}}{% endblock %}
{% block h1 %}Report: {{report.name}} {% endblock %}

{% block headextra %}
<style>
.results{
    padding-left: 0;
}
.results .success{
    background-color: green;
    font-weight: bold;
    padding: 5px;
    margin-bottom: 5px;
    list-style-type: none;
}
.results .fail{
    background-color: #222;
    font-weight: bold;
    padding: 5px;
    margin-bottom: 5px;
    list-style-type: none;
}
.results .success a, .results .fail a{
    color: white;
}
</style>
{% endblock %}

{% block subbreadcrumbs %}
<li><a href="{% url reports.views.view_reports %}">Reports</a></li> 
<li>{{report.name}} </li>
{% endblock %}

{% block actions %}
<div id="actions">
    <h2>Actions</h2>
    <ul>
        {% if not readonly %}
        <li><a href="{% url reports.views.new_access_rule report=report.slug %}">New Access Rule</a></li>
        <li><a href="#">New Schedule Rule</a></li>
        <li><a href="{% url reports.views.new_component report=report.slug %}">New Report Component</a></li>
        <li><a href="{% url reports.views.new_query report=report.slug %}">New Query</a></li>
        {% endif %}
        <li><a href="{% url reports.views.run report=report.slug %}">Run This Report Right Now</a></li>
    </ul>
</div>
{% endblock %}

{% block content %}

<em>{{report.description}}</em>

<h2>Access Rules</h2>
<ul>
{% for access_rule in access_rules %}
    <li>
        {{access_rule.person.name}}
        {% if not readonly %}
        - <a href="{% url reports.views.delete_access_rule report=report.slug access_rule_id=access_rule.id%}">Delete</a>
        {% endif %}
        {% if access_rule.notify %}
            <small> - this person receives an email every time this report is successfully run.</small> 
        {% endif %}
    </li>
{% endfor %} 
</ul>

<h2>Schedule Rules</h2>

<h2>Report Components</h2>

<ul>
{% for component in components %}
    <li>{{component.file_location}} - 
        {% if not readonly %}
        <a href="{% url reports.views.delete_component report=report.slug component_id=component.id %}">Delete</a>
        {% endif %}
    </li>
{% endfor %}
</ul>

<h2>Queries</h2>
<ul>
{% for query in queries %}
    <li><strong>{{query.name}} </strong> 
        <pre>{{query.query}}</pre>
        {% if not readonly %}
        - 
        <a href="{% url reports.views.delete_query report=report.slug query_id=query.id %}">Delete</a> | 
        <a href="{% url reports.views.edit_query report=report.slug query_id=query.id %}">Edit</a></li> 
        {% endif %}
{% endfor %}
</ul>

<h2>Results</h2>
<ul class='results'>
{% for run in runs %}
    <li class='{{run.success|yesno:"success,fail,other"}}'>
        <a href="{% url reports.views.view_run report=report.slug run=run.slug %}">{{run.created_at}}</a>
        {% if not readonly %}
        <a style='float:right' href="{% url reports.views.delete_run report=report.slug run=run.slug %}">Delete</a>
        {% endif %}
    </li>
{% endfor %}
</ul>

{% endblock %}
