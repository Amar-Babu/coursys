{% extends "base.html" %}
{% load markup %}
{% load mobile_tags %}
{% load form_display %}

{% block title %}New Letter for {{grad.person.last_name}}, {{grad.person.first_name}}{% endblock %}
{% block h1 %}New Letter for {{grad.person.last_name}}, {{grad.person.first_name}}{% endblock %}

{% block subbreadcrumbs %}
<li>&gt; <a href="{% url grad.views.index %}">Grad</a></li>
<li>&gt; <a href="{% url grad.views.view grad_slug=grad.slug%}">{{grad.person.name}}, {{grad.program.label}}</a></li>
<li>&gt; <a href="{% url grad.views.manage_letters grad_slug=grad.slug%}">Letters</a></li>
<li>&gt; New</li>
{% endblock %}
{% block headextra %}
<script type="text/javascript" src="{{MEDIA_URL}}js/grad.js"></script>
<script type="text/javascript">//<![CDATA[
	var urlMap = {
	{% for k in templates %}
	'{{k.id}}' : '{% url grad.views.get_letter_text grad_slug=grad.slug letter_template_id=k.id %}'
	{% if not forloop.last %},{% endif %}
	{% endfor %}
	};

	$(document).ready(function() {
		$('#id_content').attr("disabled", "disabled");
		$("#id_date").datepicker({
			'dateFormat' : 'yy-mm-dd'
		});
		$('#content_note').show('slow');

		get_addresses('{% url grad.views.get_addresses %}')

		$("#id_template").change(function() {
			var template_val
			template_val = $("#id_template").val();
			$("#id_content").empty();
			if(template_val == 0) {
				$('#id_content').attr("disabled", "disabled");
				$('#content_note').show('slow');
			} else {
				url = urlMap[$(this).val()];
				$('#id_content').removeAttr("disabled");
				$('#content_note').hide('slow');
				getData(url);
			}
		});

		$("#id_from_person").change(update_from_lines);
		update_from_lines();
	});

//]]></script>
{% endblock %}
{% block content %}
<div class="form_container">
	<form action="{% url grad.views.new_letter grad_slug=grad.slug%}" method="post">
		{% csrf_token %}
		<fieldset>
			<legend>
				Letter Info
			</legend>
			{{ form.non_field_errors }}
			<dl class="dlform">
				<dt>
					<label>Template:</label>
				</dt>
				<dd>
					<div class="field">
						<select name="template" id="id_template">
							<option value="0"> --- Pick an existing template --- </option>
							{% for t in templates%} <option value="{{t.id}}">{{t.label}}</option>
							{% endfor %}
						</select>
						{{form.template.errors}}
						<div style="color: red; font-weight: normal; float: right; margin-right: 200px;" id="content_note">
						Please select a template.
					</div>
					</div>

				</dd>
			</dl>
			<div style="clear: both"></div>
			{{form|as_dl_excludefields:"template"}}
			<p>
				<input  class="submit"  type="submit" value="Submit" />
			</p>
		</fieldset>
	</form>
</div>
<p class="gradback"><a class="button" href="{% url grad.views.view grad_slug=grad.slug %}">Return to Profile</a></p>
{% endblock %} 
