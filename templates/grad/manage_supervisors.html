{% extends "base.html" %}
{% load markup %}
{% load mobile_tags %}
{% load form_display %}

{% block actions %}
<div id="actions">
<h2>Actions</h2>
<ul>
<li><a href="{% url grad.views.view_all grad_slug=grad.slug %}">View All Info</a></li>	
<li class="newsec"><a href="{% url grad.views.manage_academics grad_slug=grad.slug %}">Manage Academics</a></li>
<li><a href="{% url grad.views.manage_requirements grad_slug=grad.slug  %}">Manage Requirements</a></li>
<li><a href="{% url grad.views.manage_status grad_slug=grad.slug  %}">Manage Status</a></li>
</ul>
</div>
{% endblock %}

{% block title %}{{page_title}}{% endblock %}
{% block h1 %}{{page_title}}{% endblock %}

{% block subbreadcrumbs %}
<li>
	&gt; <a href="{% url grad.views.index %}">Grad</a>
</li>
<li>
	&gt;<a href="{% url grad.views.view_all grad_slug=grad.slug%}"> {{crumb}}</a>
</li>
<li>
	&gt; Supervisors
</li>
{% endblock %}

{% block headextra %}
<script type="text/javascript" src="{{MEDIA_URL}}js/grad.js"></script>
{% endblock %}

{% block content %}
<div class="table_container">
	<table class="info">
		<tbody>
			{% for field, value in gp %}
			<tr>
				<th><label>{{field}} :</label></th>
				<td> {{ value }} </td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
</div>
{% if potential_supervisors_form %}
<div id="form_container">
	<form method="post" action="{% url grad.views.manage_supervisors grad_slug=grad.slug %}">
		{% csrf_token %}
		<fieldset>
			<legend>
				Potential Supervisor
			</legend>
			{{ potential_supervisors_form|as_dl_2 }}
			<p>
				<input class="submit" type="submit" value="Update" />
			</p>
		</fieldset>
	</form>
</div>
{% endif %}
<div id="formset_container">
	<form method="post" action="{% url grad.views.update_supervisors grad_slug=grad.slug %}">
		{% csrf_token %}
		{{ supervisors_formset.management_form }}
		<fieldset>
			<legend>
				Supervisors
			</legend>
			<p>
				Choose only a Supervisor or enter an External.
			</p>
			<div id="supervisor-forms">
			{% for form in supervisors_formset.forms %}
				<div id="supervisor-form-{{ forloop.counter0 }}">
					<p id="supervisor-form-{{ forloop.counter0 }}-label">Supervisor {{ forloop.counter }}:</p>
					{{ form.as_p }}
				</div>
			
			{% endfor %}
			</div>
			<span id="form_btns">
				<input class="submit" type="submit" value="Update" />
			</span>
		</fieldset>
	</form>
	<a class="button" href="{% url grad.views.view_all grad_slug=grad.slug %}">Cancel</a>
</div>
<script type="text/javascript">
	// dynamically append button for no-script compatibility
	$(function() {
		$("#form_btns").append('<input id="add_btn" class="submit" type="button" value="Add Another" onclick="add()" />');
		var selectOptions = $('select[id*="supervisor"]');
		processSelections(selectOptions);
		selectOptions.each(function(){
			$(this).change(function(){
				processSelections(selectOptions);
				$('#'+$(this).attr('id').replace('supervisor_0','external')).val('');
			});
		});
		var total_forms = $('#id_form-TOTAL_FORMS').val()*1;
		var max_forms = $('#id_form-MAX_NUM_FORMS').val()*1;
		if (total_forms*1 >= max_forms){
			$('#add_btn').attr('disabled', true).css('background-color','#bba');
		}
	});

</script>
{% endblock %} 
