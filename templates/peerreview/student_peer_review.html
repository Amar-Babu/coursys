{% extends "grades/base.html" %}
{% load grade_student %}

{% block title %}{{activity.name}} Peer Review{% endblock %}
{% block h1 %}{{activity.name}} Peer Review{% endblock %}

{% block grades_headextra %}
<script type="text/javascript">
    $(document).ready(function() {
        $('.review_button').click(function(){
            window.location = this.value + "/"
        })
    });
</script>
<style type="text/css">
.review {
    background:#F8F8C2;
    height: 5em;
    width: 40em;
    margin-bottom:10px;
    border-style:solid;
    border-width:1px;
    border-color:#BFBAB0;
}
.reviewed {
    background:#F2EFE9;
    height: 5em;
    width: 40em;
    margin-bottom:10px;
    border-style:solid;
    border-width:1px;
    border-color:#BFBAB0;
}
.reviewed legend {
    position:absolute;
    margin-top:0.5em;
    margin-left:2.3em;
    color:green;
    font-size:1em;
}
.feedback {
    margin-bottom:20px;
    margin-left:10px;
    margin-bottom:20px;
    padding:10px;
    padding-top:8px;
    -webkit-border-radius:5px;
    width:800px;
    border-style:solid;
    border-width:1px;
    border-color:#CCC;
}
.identifier {
    margin-left:1em;
    margin-top:0.7em;
    font-size:2em;
}
.review_button {
    color:white;
    background-color:#B5111A;
    border-style:solid;
    border-width:1px;
    border-color:#FFF;
    margin-top:0.5em;
    float:right;
}
.empty {
    margin-left:1em;
}
.mark_component {
    color:red;
}
</style>
{% endblock %}

{% block subbreadcrumbs %}
<li><a href="{% url grades.views.course_info course_slug=course.slug %}">&gt; {{course.name}}</a></li>
<li><a href="{% url grades.views.activity_info course_slug=course.slug activity_slug=activity.slug %}">&gt; {{activity.name}}</a></li>
<li>&gt; Peer Review</li>
{% endblock %}

{% block actions %}
{% endblock %}

{% block content %}
{% if not locked %}
    {% if activity_lock %}
        <h2>You can not start peer review until after {{activity_lock.effective_date}}.</h2>
    {% else %}
        <h2>Peer review is not available at this time; go for a coffee and try again later, cowboy.</h2>
    {% endif %}
{% else %}
    {% if activity_lock %}
        {% for review in reviewer_components %}
            {% if review.reviewed %}
                <div class="reviewed">
                    <div class="identifier">{{ review.identifier }}</div>
                    <legend>reviewed</legend>
                    <button class="review_button" value="{{ review.slug }}">Review</button>
                </div>
            {% else %}
                <div class="review">
                    <div class="identifier">{{ review.identifier }}</div>
                    <button class="review_button" value="{{ review.slug }}">Review</button>
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
        <h2>Peer review is not available at this time; go for a coffee and try again later, cowboy.</h2>
    {% endif %}

    {% if reviewee_components %}
    <h2>Other people's comments on your work:</h2>
    {% for component in reviewee_components %}
        <h3>{{ component.title|linebreaks}}</h3>
        {% if component.max_mark%}
            <p class="empty mark_component">{{component.title}} has no mark component</p>
        {% endif %}<br>
        
        {% for student_mark in component.student_marks %}
            <div class="feedback">
                {% if component.max_mark %}
                <div class="mark_component">
                    {{ student_mark.mark}} / {{component.max_mark}}
                </div><br>
                {% endif %}
                {{student_mark.textbox|linebreaksbr}}
            </div>
        {% endfor %}
    {% endfor %}
    {% endif %}
{% endif %}
{% endblock %}
